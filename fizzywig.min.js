(function(a,b){function d(){var a={},b={};return a.on=function(c,d){return c=c.split(/\s+/),c.forEach(function(a){b[a]=b[a]||[],b[a].indexOf(d)===-1&&b[a].push(d)}),a},a.off=function(c,d){return c=c.split(/\s+/),c.forEach(function(a){if(b[a]){var c=b[a].indexOf(d);b[a]=b[a].slice(0,c).concat(b[a].slice(c+1))}}),a},a.emit=function(a,c){a=a.split(/\s+/),a.forEach(function(a){b[a]&&b[a].forEach(function(a){a.apply(this,c)})})},a}function e(a,b){var d={},e,f,h;return typeof a=="string"?e=document.querySelector(a):a instanceof Element&&(e=a),f=e.querySelectorAll("[data-content-editor-command]"),f=Array.prototype.map.apply(f,[function(a){return g(a)}]).filter(function(a){return!!a}),d.enable=function(){return f.forEach(function(a){a.enable()}),d},d.disable=function(){return f.forEach(function(a){console.log(a)}),d},c.emitter.on("focus",function(){h=!0,d.enable()}),c.emitter.on("blur",function(a){h=!1,setTimeout(function(){h||d.disable()},150)}),c.emitter.on("click",function(){h=!0}),d.disable()}function f(a,b){function g(b){c.block_elements.indexOf(document.queryCommandValue("formatBlock"))===-1&&document.execCommand("formatBlock",!1,"<p>"),b.which===8&&!a.textContent.trim()&&b.preventDefault()}function h(b){setTimeout(function(){a.innerHTML=c.sanitizer(a.innerHTML,"paste")},1)}function i(a){c.emitter.emit(a.type,[a])}var d={},e,f;return e=a.getAttribute("data-content-editable")||"data",d.enable=function(){return a.setAttribute("contentEditable",!0),d},d.disable=function(){return a.removeAttribute("contentEditable"),d},d.json=function(){var b={};return v(b,e,a.innerHTML),b},w(a,"focus blur keyup mouseup paste change",i),w(a,"keydown",g),w(a,"paste",h),d.enable()}function g(a){var b,c,d,e,f;c=a.getAttribute("data-content-editor-command"),d=a.getAttribute("data-content-editor-value"),e=a.getAttribute("data-content-editor-prompt"),b=d||c;if(g.types.hasOwnProperty(b))return new g.types[b](a,c,d,e)}function i(a,b,c,d){this.node=a,this.command=b,this.value=c,this.prompt=d,this.active=!1}function k(){i.apply(this,arguments)}function m(){i.apply(this,arguments)}function o(){i.apply(this,arguments)}function q(){i.apply(this,arguments)}function s(){var b,c={};return a.getSelection?(b=a.getSelection(),b.rangeCount&&(b=b.getRangeAt(0))):document.selection&&(b=document.selection.createRange()),c.is=function(a){return a.toLowerCase()===c.parentNode()},c.parentNode=function(){return b&&b.startContainer.parentNode.nodeName.toLowerCase()},c.restore=function(){if(a.getSelection){var c=a.getSelection();c.removeAllRanges(),c.addRange(b)}else document.selection&&b.select&&b.select()},c}function t(){var a={},c={};return c.prompt=function(c,d){if(d!==b)a[c]=d;else if(typeof a[c]=="function")return a[c].call(null)},c}function u(){var a=Array.prototype.slice.apply(arguments);return a.reduce(function(a,b){return Object.keys(b).forEach(function(c){a[c]&&a[c].constructor===Object&&b[c].constructor===Object?u(a[c],b[c]):a[c]=b[c]}),a})}function v(a,b,c){function d(a,b,c,d){return a[b]}function e(a,b,d,e){return d===e.length-1?a[b]=c:a[b]||(a[b]={})}return typeof b=="string"&&(b=b.split(".")),b.reduce(typeof c=="undefined"?d:e,a)}function w(a,b,c,d){b=b.split(/\s+/),b.forEach(function(b){a.addEventListener?a.addEventListener(b,A.apply(this,[c]),d||!1):a.attachEvent&&a.attachEvent("on"+b,A.apply(this,[c]))})}function x(a,b,c){b=b.split(/\s+/),b.forEach(function(b){a.addEventListener?a.removeEventListener(b,A.apply(this,[c])):a.attachEvent&&a.detachEvent("on"+b,A.apply(this,[c]))})}function y(a,b){var c=a.className.split(/\s+/);c.indexOf(b)===-1&&c.push(b),a.className=c.join(" ")}function z(a,b){var c=a.className.split(/\s+/),d=c.indexOf(b);d!==-1&&(c=c.slice(0,d).concat(c.slice(d+1))),a.className=c.join(" ")}function A(b){return function(c){c||(c=a.event);if(!("defaultPrevented"in c)){c.defaultPrevented=!1;var d=c.preventDefault;c.preventDefault=function(){this.defaultPrevented=!0,this.returnValue=!1,d.call(this)}}c.target=c.target||c.srcElement,c.which=c.keyCode||c.charCode,b.apply(this,[c])}}var c;c={version:"0.0.1",block_elements:["p","pre","Normal"],inline_elements:["b","i","strong","em","a","del","strike"],void_elements:["img","br","hr"]},[1,2,3,4,5,6].forEach(function(a){c.block_elements.push("Heading "+a),c.block_elements.push("h"+a)}),c.emitter=d(),c.content=function(a){function k(){if(i)return;i=setTimeout(function(){var a=b.json();JSON.stringify(j)!==JSON.stringify(a)&&(c.emitter.emit("save",[a]),j=a),i=null},2e3)}var b={},d,g,h,i,j={};if(typeof a=="string")d=document.querySelectorAll(a);else if(a instanceof d||Array.isArray(a))d=a;return d=Array.prototype.map.apply(d,[function(a){return f(a,b)}]),b.toolbar=function(a){return arguments.length?(g=e(a,b),b):g},b.enable=function(){d.forEach(function(a){a.enable()});try{document.execCommand("styleWithCSS",!1,!1),document.execCommand("insertBROnReturn",!1,!1),document.execCommand("enableInlineTableEditing",!1,!1),document.execCommand("enableObjectResizing",!1,!1)}catch(a){}return b},b.disable=function(){return d.forEach(function(a){a.disable()}),b},b.json=function(){var a={},b=d.map(function(a){return a.json()});return b.unshift(a),u.apply(null,b),a},b.on=c.emitter.on,c.emitter.on("keyup change blur paste",k),b.prompt=c.prompter.prompt,b.enable()},g.types={insertImage:q,createLink:o};var h=6;while(h--)g.types["<h"+h+">"]=k;["insertunorderedlist","insertorderedlist","bold","italic","strikethrough","underline"].forEach(function(a){g.types[a]=m});var j=i.prototype;j.init=function(){c.emitter.on("keyup mouseup paste change",this.check),w(this.node,"click",this.execute),w(this.node,"blur",i.emit("blur")),w(this.node,"focus",i.emit("focus"))},j.enable=function(){this.node.removeAttribute("disabled")},j.disable=function(){this.node.setAttribute("disabled","disabled")},j.activate=function(){this.active?y(this.node,"active"):z(this.node,"active")},i.emit=function(a){return function(b){c.emitter.emit(a)}},i.block_normalization={normal:"p",heading:"h"},i.block_regexp=/(heading|normal)\s*/i,i.normalizeCommandValue=function(a){return i.block_regexp.test(a)&&(a=a.replace(i.block_regexp,function(a){return i.block_normalization[a.trim().toLowerCase()]})),"<"+a+">"};var l=k.prototype=new i;l.constructor=k,l.check=function(){var a;try{a=document.queryCommandValue(this.command)}catch(b){}a=i.normalizeCommandValue(a),this.active=this.value===a,this.activate()},l.execute=function(a){a.preventDefault();var b=this.active?"<p>":this.value;c.range.restore(),document.execCommand(this.command,!1,b),c.emitter.emit("click change")};var n=m.prototype=new i;n.constructor=m,n.check=function(){var a;try{a=document.queryCommandState(command)}catch(b){}this.active=a,this.activate()},n.execute=function(a){a.preventDefault(),c.range.restore(),document.execCommand(this.command,!1,null),c.emitter.emit("click change")};var p=o.prototype=new i;p.constructor=o,p.check=function(){this.active=c.range.is("a"),this.activate()},p.execute=function(){var a=this.active?"unlink":this.command,b=c.prompter.prompt(this.prompt);c.range.restore(),document.execCommand(a,!1,b),c.emitter.emit("click change")};var r=q.prototype=new i;r.constructor=q,r.check=function(){},r.execute=function(){c.range.restore(),document.execCommand(this.command,!1,c.prompter.prompt(this.prompt)),c.emitter.emit("click change")},c.range=s(),c.emitter.on("keyup mouseup paste change blur",function(){c.range=s()}),c.prompter=t(),c.sanitizer=function(a,b){return typeof html_sanitizer=="undefined"?a:html_sanitizer.sanitizeWithPolicy(a,c.sanitizer.policies[b])},c.sanitizer.policies={paste:function(a,b){if(c.sanitizer.paste_elements.indexOf(a)!==-1)return html_sanitizer.sanitizeAttribs(a,b,c.sanitizer.policies.uri,c.sanitizer.policies.tokens)},uri:function(a){return a},tokens:function(a){return null}},c.sanitizer.paste_elements=c.block_elements.concat(c.inline_elements,c.void_elements),a.fizzywig=c})(window);
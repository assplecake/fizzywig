(function(a,b){function d(){var a={},b={};return a.on=function(c,d){return c=c.split(/\s+/),c.forEach(function(a){b[a]=b[a]||[],b[a].indexOf(d)===-1&&b[a].push(d)}),a},a.off=function(c,d){return c=c.split(/\s+/),c.forEach(function(a){if(b[a]){var c=b[a].indexOf(d);b[a]=b[a].slice(0,c).concat(b[a].slice(c+1))}}),a},a.emit=function(a,c){a=a.split(/\s+/),a.forEach(function(a){b[a]&&b[a].forEach(function(a){a.apply(this,c)})})},a}function e(a,b){var d={},e,f,h;return typeof a=="string"?e=document.querySelector(a):a instanceof Element&&(e=a),f=e.querySelectorAll("[data-content-editor-command]"),f=Array.prototype.map.apply(f,[function(a){return g(a)}]),d.enable=function(){return f.forEach(function(a){a.enable()}),d},d.disable=function(){return f.forEach(function(a){a.disable()}),d},c.emitter.on("focus",function(){h=!0,d.enable()}),c.emitter.on("blur",function(a){h=!1,setTimeout(function(){h||d.disable()},150)}),c.emitter.on("click",function(){h=!0}),d.disable()}function f(a,b){function f(b){c.block_elements.indexOf(document.queryCommandValue("formatBlock"))===-1&&document.execCommand("formatBlock",!1,"<p>"),b.which===8&&!a.textContent.trim()&&b.preventDefault()}function g(a){c.emitter.emit(a.type,[a])}var d={},e;return e=a.getAttribute("data-content-editable")||"data",d.enable=function(){return a.setAttribute("contentEditable",!0),d},d.disable=function(){return a.removeAttribute("contentEditable"),d},d.json=function(){var b={};return n(b,e,a.innerHTML),b},o(a,"focus blur keyup mouseup paste change",g),o(a,"keydown",f),d.enable()}function g(a){function k(){var a,g;try{a=document.queryCommandState(d),g=document.queryCommandValue(d)}catch(i){}e?(g=j(g),f=e===g):f=a||h&&c.range.is("a"),b.activate()}function l(a){return function(b){c.emitter.emit(a)}}function m(a){a.preventDefault();var b=h&&f?"unlink":d,j=g&&f?"<p>":e;i&&!f&&(j=c.prompter.prompt(i)),c.range.restore(),document.execCommand(b,!1,j),c.emitter.emit("click change")}var b={},d,e,f,g,h,i;return d=a.getAttribute("data-content-editor-command"),e=a.getAttribute("data-content-editor-value"),i=a.getAttribute("data-content-editor-prompt"),g=e&&e.charAt(1).toLowerCase()==="h",h=d.toLowerCase()==="createlink",b.enable=function(){a.removeAttribute("disabled")},b.disable=function(){a.setAttribute("disabled","disabled")},b.activate=function(){f?q(a,"active"):r(a,"active")},c.emitter.on("keyup mouseup paste change",k),o(a,"click",m),o(a,"blur",l("blur")),o(a,"focus",l("focus")),b}function j(a){return i.test(a)&&(a=a.replace(i,function(a){return h[a.trim().toLowerCase()]})),"<"+a+">"}function k(){var b,c={};return a.getSelection?(b=a.getSelection(),b.rangeCount&&(b=b.getRangeAt(0))):document.selection&&(b=document.selection.createRange()),c.is=function(a){return a.toLowerCase()===c.parentNode()},c.parentNode=function(){return b&&b.startContainer.parentNode.nodeName.toLowerCase()},c.restore=function(){if(a.getSelection){var c=a.getSelection();c.removeAllRanges(),c.addRange(b)}else document.selection&&b.select&&b.select()},c}function l(){var a={},c={};return c.prompt=function(c,d){if(d!==b)a[c]=d;else if(typeof a[c]=="function")return a[c].call(null)},c}function m(){var a=Array.prototype.slice.apply(arguments);return a.reduce(function(a,b){return Object.keys(b).forEach(function(c){a[c]&&a[c].constructor===Object&&b[c].constructor===Object?m(a[c],b[c]):a[c]=b[c]}),a})}function n(a,b,c){function d(a,b,c,d){return a[b]}function e(a,b,d,e){return d===e.length-1?a[b]=c:a[b]||(a[b]={})}return typeof b=="string"&&(b=b.split(".")),b.reduce(typeof c=="undefined"?d:e,a)}function o(a,b,c,d){b=b.split(/\s+/),b.forEach(function(b){a.addEventListener?a.addEventListener(b,s.apply(this,[c]),d||!1):a.attachEvent&&a.attachEvent("on"+b,s.apply(this,[c]))})}function p(a,b,c){b=b.split(/\s+/),b.forEach(function(b){a.addEventListener?a.removeEventListener(b,s.apply(this,[c])):a.attachEvent&&a.detachEvent("on"+b,s.apply(this,[c]))})}function q(a,b){var c=a.className.split(/\s+/);c.indexOf(b)===-1&&c.push(b),a.className=c.join(" ")}function r(a,b){var c=a.className.split(/\s+/),d=c.indexOf(b);d!==-1&&(c=c.slice(0,d).concat(c.slice(d+1))),a.className=c.join(" ")}function s(b){return function(c){c||(c=a.event);if(!("defaultPrevented"in c)){c.defaultPrevented=!1;var d=c.preventDefault;c.preventDefault=function(){this.defaultPrevented=!0,this.returnValue=!1,d.call(this)}}c.target=c.target||c.srcElement,c.which=c.keyCode||c.charCode,b.apply(this,[c])}}var c;c={version:"0.0.1",block_elements:["p","pre","Normal"]},[1,2,3,4,5,6].forEach(function(a){c.block_elements.push("Heading "+a),c.block_elements.push("h"+a)}),c.emitter=d(),c.content=function(a){function k(){if(i)return;i=setTimeout(function(){var a=b.json();JSON.stringify(j)!==JSON.stringify(a)&&(c.emitter.emit("save",[a]),j=a),i=null},2e3)}var b={},d,g,h,i,j={};if(typeof a=="string")d=document.querySelectorAll(a);else if(a instanceof d||Array.isArray(a))d=a;return d=Array.prototype.map.apply(d,[function(a){return f(a,b)}]),b.toolbar=function(a){return arguments.length?(g=e(a,b),b):g},b.enable=function(){d.forEach(function(a){a.enable()});try{document.execCommand("styleWithCSS",!1,!1),document.execCommand("insertBROnReturn",!1,!1),document.execCommand("enableInlineTableEditing",!1,!1),document.execCommand("enableObjectResizing",!1,!1)}catch(a){}return b},b.disable=function(){return d.forEach(function(a){a.disable()}),b},b.json=function(){var a={},b=d.map(function(a){return a.json()});return b.unshift(a),m.apply(null,b),a},b.on=c.emitter.on,c.emitter.on("keyup change blur paste",k),b.prompt=c.prompter.prompt,b.enable()};var h={normal:"p",heading:"h"},i=/(heading|normal)\s*/i;c.range=k(),c.emitter.on("keyup mouseup paste change blur",function(){c.range=k()}),c.prompter=l(),a.fizzywig=c})(window);
(function(a,b){function d(){var a={},b={};return a.on=function(c,d){return c=c.split(/\s+/),c.forEach(function(a){b[a]=b[a]||[],b[a].indexOf(d)===-1&&b[a].push(d)}),a},a.off=function(c,d){return c=c.split(/\s+/),c.forEach(function(a){if(b[a]){var c=b[a].indexOf(d);b[a]=b[a].slice(0,c).concat(b[a].slice(c+1))}}),a},a.emit=function(a,c){a=a.split(/\s+/),a.forEach(function(a){b[a]&&b[a].forEach(function(a){a.apply(this,c)})})},a}function e(b,d){var e={},f,h,i;return typeof b=="string"?f=document.querySelector(b):b instanceof Element&&(f=b),h=f.querySelectorAll("[data-content-editor-command]"),h=Array.prototype.map.apply(h,[function(a){return g(a)}]),e.enable=function(){return h.forEach(function(a){a.enable()}),e},e.disable=function(){return h.forEach(function(a){a.disable()}),e},c.emitter.on("focus",function(){i=!0,e.enable()}),c.emitter.on("blur",function(b){var c;a.getSelection?(c=a.getSelection(),c.rangeCount&&(c=c.getRangeAt(0))):document.selection&&(c=document.selection.createRange()),i=!1,setTimeout(function(){i||e.disable()},150)}),c.emitter.on("click",function(){i=!0}),e.disable()}function f(a,b){function f(a){return function(b){c.emitter.emit(a)}}var d={},e;return e=a.getAttribute("data-content-editable")||"data",d.enable=function(){return a.setAttribute("contentEditable",!0),d},d.disable=function(){return a.removeAttribute("contentEditable"),d},d.json=function(){var b={};return l(b,e,a.innerHTML),b},m(a,"focus",f("focus")),m(a,"blur",f("blur")),m(a,"keyup",f("keyup")),m(a,"mouseup",f("mouseup")),m(a,"paste",f("paste")),m(a,"change",f("change")),d.enable()}function g(a){function h(){var a,c;try{a=document.queryCommandState(d),c=document.queryCommandValue(d)}catch(g){}e?(c=j(c),f=e===c):f=a,b.activate()}function i(a){return function(b){c.emitter.emit(a)}}function k(a){a.preventDefault();var b=g&&f?"p":e;document.execCommand(d,!1,b),c.emitter.emit("click change")}var b={},d,e,f,g;return d=a.getAttribute("data-content-editor-command"),e=a.getAttribute("data-content-editor-value"),g=e&&e.charAt(0).toLowerCase()==="h",b.enable=function(){a.removeAttribute("disabled")},b.disable=function(){a.setAttribute("disabled","disabled")},b.activate=function(){f?o(a,"active"):p(a,"active")},c.emitter.on("keyup mouseup paste change",h),m(a,"click",k),m(a,"blur",i("blur")),m(a,"focus",i("focus")),b}function j(a){return i.test(a)&&(a=a.replace(i,function(a){return h[a.trim().toLowerCase()]})),a}function k(){var a=Array.prototype.slice.apply(arguments);return a.reduce(function(a,b){return Object.keys(b).forEach(function(c){a[c]&&a[c].constructor===Object&&b[c].constructor===Object?k(a[c],b[c]):a[c]=b[c]}),a})}function l(a,b,c){function d(a,b,c,d){return a[b]}function e(a,b,d,e){return d===e.length-1?a[b]=c:a[b]||(a[b]={})}return typeof b=="string"&&(b=b.split(".")),b.reduce(typeof c=="undefined"?d:e,a)}function m(a,b,c,d){a.addEventListener?a.addEventListener(b,q.apply(this,[c]),d||!1):a.attachEvent&&a.attachEvent("on"+b,q.apply(this,[c]))}function n(a,b,c){a.addEventListener?a.removeEventListener(b,q.apply(this,[c])):a.attachEvent&&a.detachEvent("on"+b,q.apply(this,[c]))}function o(a,b){var c=a.className.split(/\s+/);c.indexOf(b)===-1&&c.push(b),a.className=c.join(" ")}function p(a,b){var c=a.className.split(/\s+/),d=c.indexOf(b);d!==-1&&(c=c.slice(0,d).concat(c.slice(d+1))),a.className=c.join(" ")}function q(b){return function(c){c||(c=a.event);if(!("defaultPrevented"in c)){c.defaultPrevented=!1;var d=c.preventDefault;c.preventDefault=function(){this.defaultPrevented=!0,this.returnValue=!1,d.call(this)}}c.target=c.target||c.srcElement,c.which=c.keyCode||c.charCode,b.apply(this,[c])}}var c;c={version:"0.0.1"},c.emitter=d(),c.content=function(a){function l(){if(i)return;i=setTimeout(function(){var a=b.json();JSON.stringify(j)!==JSON.stringify(a)&&(c.emitter.emit("save",[a]),j=a),i=null},2e3)}var b={},d,g,h,i,j={};if(typeof a=="string")d=document.querySelectorAll(a);else if(a instanceof d||Array.isArray(a))d=a;return d=Array.prototype.map.apply(d,[function(a){return f(a,b)}]),b.toolbar=function(a){return arguments.length?(g=e(a,b),b):g},b.enable=function(){return d.forEach(function(a){a.enable()}),b},b.disable=function(){return d.forEach(function(a){a.disable()}),b},b.json=function(){var a={},b=d.map(function(a){return a.json()});return b.unshift(a),k.apply(null,b),a},b.on=c.emitter.on,c.emitter.on("keyup change blur paste",l),b.enable()};var h={normal:"p",heading:"h"},i=/(heading|normal)\s*/i;a.fizzywig=c})(window);